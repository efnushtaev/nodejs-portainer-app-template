FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./

# Установка зависимостей с очисткой кеша
RUN npm config set registry https://registry.npmjs.org/ && \
    npm install --legacy-peer-deps --silent && \
    npm cache clean --force

COPY . .
RUN npm run build

# Финальная стадия для копирования файлов
FROM alpine:latest AS final
COPY --from=builder /app/build /frontend-build
COPY ./nginx/nginx.conf /nginx.conf