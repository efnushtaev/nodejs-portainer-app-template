FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm config set registry https://registry.npmjs.org/ && \
    npm install
COPY . .
RUN npm run build

# Финальный образ для копирования файлов
FROM alpine:latest AS final
# Копируем собранный фронтенд
COPY --from=builder /app/build /frontend-build
# Копируем конфиг Nginx
COPY ./nginx/nginx.conf /nginx.conf